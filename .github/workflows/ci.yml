name: Build Official Blink Example

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build-official-blink:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install Pico toolchain
      run: |
        sudo apt-get update
        sudo apt-get install -y cmake gcc-arm-none-eabi libnewlib-arm-none-eabi git wget
        
    - name: Clone Pico SDK and Examples
      run: |
        git clone https://github.com/raspberrypi/pico-sdk.git /tmp/pico-sdk
        cd /tmp/pico-sdk
        git submodule update --init
        
        git clone https://github.com/raspberrypi/pico-examples.git /tmp/pico-examples
        
    - name: Build official blink example
      run: |
        mkdir -p /tmp/pico-examples/build
        cd /tmp/pico-examples/build
        
        # Build the official blink example
        cmake -DPICO_SDK_PATH=/tmp/pico-sdk -DPICO_BOARD=pico_w ..
        make blink -j4
        
        echo "=== Official blink build results ==="
        ls -la blink/*.uf2
        
    - name: Copy and test official blink UF2
      run: |
        # Copy the official built UF2 to our workspace
        cp /tmp/pico-examples/build/blink/blink.uf2 ./official_built_blink.uf2
        
        echo "=== File comparison ==="
        echo "Official downloaded: $(stat -c%s official_blink.uf2 2>/dev/null || echo 'N/A') bytes"
        echo "Official built: $(stat -c%s official_built_blink.uf2) bytes"
        
        echo "=== UF2 Headers ==="
        echo "Official built blink:"
        hexdump -C official_built_blink.uf2 | head -3
        
    - name: Upload both UF2 files
      uses: actions/upload-artifact@v4
      with:
        name: official-blink-comparison
        path: |
          official_built_blink.uf2
          /tmp/pico-examples/build/blink/blink.uf2
        retention-days: 7
