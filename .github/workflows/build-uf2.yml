name: Build Pico 2W AP HTTP

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # ---- Checkout your repository ----
    - name: Checkout source
      uses: actions/checkout@v4

    # ---- Install dependencies ----
    - name: Install build tools
      run: |
        sudo apt update
        sudo apt install gcc-arm-none-eabi binutils-arm-none-eabi -y

    # ---- Fetch the official Pico SDK ----
    - name: Clone Pico SDK
      run: |
        git clone --branch 2.1.0 --depth=1 https://github.com/raspberrypi/pico-sdk.git
        echo "PICO_SDK_PATH=${GITHUB_WORKSPACE}/pico-sdk" >> $GITHUB_ENV

    # ---- Configure and build ----
    - name: Configure project
      run: |
        mkdir -p build
        cd build
        which arm-none-eabi-gcc
        arm-none-eabi-gcc --version
        cmake .. \
          -DPICO_BOARD=pico2 \
          -DPICO_PLATFORM=rp2350 \
          -DPICO_SDK_PATH=${{ env.PICO_SDK_PATH }}
          -DCMAKE_C_COMPILER=arm-none-eabi-gcc -DCMAKE_CXX_COMPILER=arm-none-eabi-g++

    - name: Build project
      run: |
        cd build
        make -j$(nproc)

    # ---- Upload build outputs (.uf2, .elf, .bin) ----
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: pico2w-ap-http
        path: |
          build/*.uf2
          build/*.elf
          build/*.bin
